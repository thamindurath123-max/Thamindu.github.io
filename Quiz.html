<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IMAT Quiz</title>
    <style>
        body {font-family: Arial; background:#222; color:white; margin:0; padding:20px;}
        .box {max-width:700px; margin:auto; background:#333; padding:20px; border-radius:15px;}
        #question {font-size:20px; margin:30px 0;}
        .option {background:#444; padding:15px; margin:10px; border-radius:8px; cursor:pointer;}
        .option:hover {background:#555;}
        #timer {font-size:28px; color:#ff4444;}
        .correct {background:#28a745!important;}
        .wrong {background:#dc3545!important;}
    </style>
</head>
<body>
<div class="box">
    <div id="timer"></div>
    <div id="progress">Question <span id="num">1</span> of <span id="total"></span></div>
    <div id="question"></div>
    <div id="options"></div>
    <div id="result" style="margin-top:30px; font-size:22px;"></div>
</div>

<script>
const urlParams = new URLSearchParams(location.search);
const section = urlParams.get('s') || 'all';
const difficulty = urlParams.get('d') || 'all';
const mode = urlParams.get('m') || '20';

let questions = [], selected = [], current = 0, score = 0, secondsLeft;

fetch('questions.json')
    .then(r => r.json())
    .then(data => {
        let filtered = data;
        if (section !== 'all') filtered = filtered.filter(q => q.section === section);
        if (difficulty !== 'all') filtered = filtered.filter(q => q.difficulty === difficulty);
        questions = filtered.sort(() => Math.random() - 0.5);

        const numQ = mode === 'mock' ? 100 : parseInt(mode);
        questions = questions.slice(0, numQ);
        document.getElementById('total').textContent = questions.length;

        secondsLeft = mode === 'mock' ? 90*60 : parseInt(mode)*60;
        startTimer();
        showQuestion();
    });

function showQuestion() {
    if (current >= questions.length) endQuiz();
    const q = questions[current];
    document.getElementById('question').textContent = q.question;
    document.getElementById('num').textContent = current + 1;
    const opts = document.getElementById('options');
    opts.innerHTML = '';
    q.options.forEach((opt, i) => {
        const div = document.createElement('div');
        div.className = 'option';
        div.textContent = opt;
        div.onclick = () => selectAnswer(i);
        opts.appendChild(div);
    });
}

function selectAnswer(choice) {
    if (selected[current] !== undefined) return;
    selected[current] = choice;
    const q = questions[current];
    const opts = document.querySelectorAll('.option');
    opts.forEach((opt, i) => {
        if (i === q.correct) opt.classList.add('correct');
        else if (i === choice && i !== q.correct) opt.classList.add('wrong');
    });
    if (choice === q.correct) score++;
    setTimeout(() => {
        current++;
        showQuestion();
    }, 1500);
}

function startTimer() {
    const timer = document.getElementById('timer');
    const interval = setInterval(() => {
        secondsLeft--;
        const m = Math.floor(secondsLeft/60).toString().padStart(2,'0');
        const s = (secondsLeft%60).toString().padStart(2,'0');
        timer.textContent = `Time Left: ${m}:${s}`;
        if (secondsLeft <= 0) { clearInterval(interval); endQuiz(); }
    }, 1000);
}

function endQuiz() {
    document.body.innerHTML = `
        <div class="box">
            <h1>Quiz Finished!</h1>
            <p style="font-size:28px;">Your score: ${score} / ${questions.length}</p>
            <p>Want step-by-step explanations + full syllabus + high-yield summaries?<br>
               <a href="YOUR_EBOOK_LINK_HERE" target="_blank" style="color:#00ff00; font-size:24px;">→ Buy my IMAT eBook now ←</a></p>
            <button onclick="location.href='index.html'" style="padding:15px; font-size:18px; margin-top:20px;">Back to Home</button>
        </div>`;
}
</script>
</body>
</html>
